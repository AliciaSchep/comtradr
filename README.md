
<!-- README.md is generated from README.Rmd. Please edit that file -->
comtradr
========

R package for interacting with the [UN Comtrade Database](https://comtrade.un.org/data/) public API. UN Comtrade provides historical data on the weights and value of specific goods shipped between countries, more info can be found [here](https://comtrade.un.org/). Full API documentation can be found [here](https://comtrade.un.org/data/doc/api/).

This package was inspired by the [R tutorial](https://comtrade.un.org/data/Doc/api/ex/r) posted by Comtrade, and is built using [httr](https://cran.r-project.org/web/packages/httr/index.html) and [jsonlite](https://cran.r-project.org/web/packages/jsonlite/index.html).

Installation
------------

``` r
# install.packages("devtools")
devtools::install_github("ChrisMuir/comtradr")
```

Example Usage
-------------

***Example 1*: Return all exports from China to South Korea, United States and Mexico, for all years**

``` r
library(comtradr)

# First, read in the country code lookup table as a dataframe from Comtrade. 
# This will be used as a parameter in the API calls.
countrydf <- ct_countries_table()

# This object can can also be used to look up the exact spellings of countries 
# prior to making API calls.
country_lookup("korea", "reporter", countrydf)
#> [1] "Dem. People's Rep. of Korea" "Rep. of Korea"

# Since we want South Korea, we'll use "Rep. of Korea" within the API query.
comtrade <- ct_search(reporters = "China", 
                      partners = c("Rep. of Korea", "USA", "Mexico"), 
                      countrytable = countrydf, 
                      tradedirection = "exports")

# Inspect the return data
str(comtrade$data)
#> 'data.frame':    72 obs. of  35 variables:
#>  $ Classification        : chr  "H4" "H4" "H4" "H4" ...
#>  $ Year                  : int  2012 2012 2012 2013 2013 2013 2014 2014 2014 2015 ...
#>  $ Period                : int  2012 2012 2012 2013 2013 2013 2014 2014 2014 2015 ...
#>  $ Period Desc.          : chr  "2012" "2012" "2012" "2013" ...
#>  $ Aggregate Level       : int  0 0 0 0 0 0 0 0 0 0 ...
#>  $ Is Leaf Code          : int  0 0 0 0 0 0 0 0 0 0 ...
#>  $ Trade Flow Code       : int  2 2 2 2 2 2 2 2 2 2 ...
#>  $ Trade Flow            : chr  "Export" "Export" "Export" "Export" ...
#>  $ Reporter Code         : int  156 156 156 156 156 156 156 156 156 156 ...
#>  $ Reporter              : chr  "China" "China" "China" "China" ...
#>  $ Reporter ISO          : chr  "CHN" "CHN" "CHN" "CHN" ...
#>  $ Partner Code          : int  410 484 842 410 484 842 410 484 842 410 ...
#>  $ Partner               : chr  "Rep. of Korea" "Mexico" "USA" "Rep. of Korea" ...
#>  $ Partner ISO           : chr  "KOR" "MEX" "USA" "KOR" ...
#>  $ 2nd Partner Code      : logi  NA NA NA NA NA NA ...
#>  $ 2nd Partner           : chr  "" "" "" "" ...
#>  $ 2nd Partner ISO       : chr  "" "" "" "" ...
#>  $ Customs Proc. Code    : chr  "" "" "" "" ...
#>  $ Customs               : chr  "" "" "" "" ...
#>  $ Mode of Transport Code: chr  "" "" "" "" ...
#>  $ Mode of Transport     : chr  "" "" "" "" ...
#>  $ Commodity Code        : chr  "TOTAL" "TOTAL" "TOTAL" "TOTAL" ...
#>  $ Commodity             : chr  "All Commodities" "All Commodities" "All Commodities" "All Commodities" ...
#>  $ Qty Unit Code         : int  1 1 1 1 1 1 1 1 1 1 ...
#>  $ Qty Unit              : chr  "No Quantity" "No Quantity" "No Quantity" "No Quantity" ...
#>  $ Qty                   : logi  NA NA NA NA NA NA ...
#>  $ Alt Qty Unit Code     : chr  "" "" "" "" ...
#>  $ Alt Qty Unit          : logi  NA NA NA NA NA NA ...
#>  $ Alt Qty               : logi  NA NA NA NA NA NA ...
#>  $ Netweight (kg)        : logi  NA NA NA NA NA NA ...
#>  $ Gross weight (kg)     : logi  NA NA NA NA NA NA ...
#>  $ Trade Value (US$)     : num  8.77e+10 2.75e+10 3.52e+11 9.12e+10 2.90e+10 ...
#>  $ CIF Trade Value (US$) : logi  NA NA NA NA NA NA ...
#>  $ FOB Trade Value (US$) : logi  NA NA NA NA NA NA ...
#>  $ Flag                  : int  0 0 0 0 0 0 0 0 0 0 ...
```

***Example 2*: All shipments related to halibut between Canada and all other countries, for years 2011 thru 2015**

``` r
# First, read in the commodity code lookup table as a dataframe from Comtrade.
commoditydf <- ct_commodities_table("HS")

# Then search for halibut.
commodity_lookup("halibut", commoditydf)
#> [1] "030221 - Halibut, fresh or chilled, whole"                     
#> [2] "030229 - Flatfish, fresh/chilled not halibut/plaice/sole, whol"
#> [3] "030331 - Halibut, frozen, whole"                               
#> [4] "030339 - Flatfish except halibut, plaice or sole, frozen, whol"

# Notice that two of the results are explicitly NOT related to halibut, so 
# we'll exclude those in the API query.
comtrade <- ct_search(reporters = "Canada", 
                      partners = "All", 
                      countrytable = countrydf, 
                      tradedirection = "all", 
                      startdate = "2011-01-01", 
                      enddate = "2015-01-01", 
                      commodcodes = c("030221", "030331"))

# Inspect the output
str(comtrade$data)
#> 'data.frame':    219 obs. of  35 variables:
#>  $ Classification        : chr  "H4" "H4" "H4" "H4" ...
#>  $ Year                  : int  2012 2012 2012 2012 2012 2012 2012 2012 2012 2012 ...
#>  $ Period                : int  2012 2012 2012 2012 2012 2012 2012 2012 2012 2012 ...
#>  $ Period Desc.          : chr  "2012" "2012" "2012" "2012" ...
#>  $ Aggregate Level       : int  6 6 6 6 6 6 6 6 6 6 ...
#>  $ Is Leaf Code          : int  1 1 1 1 1 1 1 1 1 1 ...
#>  $ Trade Flow Code       : int  1 2 4 1 4 1 1 2 2 2 ...
#>  $ Trade Flow            : chr  "Import" "Export" "Re-Import" "Import" ...
#>  $ Reporter Code         : int  124 124 124 124 124 124 124 124 124 124 ...
#>  $ Reporter              : chr  "Canada" "Canada" "Canada" "Canada" ...
#>  $ Reporter ISO          : chr  "CAN" "CAN" "CAN" "CAN" ...
#>  $ Partner Code          : int  0 0 0 124 124 152 156 156 251 276 ...
#>  $ Partner               : chr  "World" "World" "World" "Canada" ...
#>  $ Partner ISO           : chr  "WLD" "WLD" "WLD" "CAN" ...
#>  $ 2nd Partner Code      : logi  NA NA NA NA NA NA ...
#>  $ 2nd Partner           : chr  "" "" "" "" ...
#>  $ 2nd Partner ISO       : chr  "" "" "" "" ...
#>  $ Customs Proc. Code    : chr  "" "" "" "" ...
#>  $ Customs               : chr  "" "" "" "" ...
#>  $ Mode of Transport Code: chr  "" "" "" "" ...
#>  $ Mode of Transport     : chr  "" "" "" "" ...
#>  $ Commodity Code        : chr  "030221" "030221" "030221" "030221" ...
#>  $ Commodity             : chr  "Fish and crustaceans, molluscs and other aquatic invertebrates // Fish, fresh or chilled, excluding fish fillets and other fish"| __truncated__ "Fish and crustaceans, molluscs and other aquatic invertebrates // Fish, fresh or chilled, excluding fish fillets and other fish"| __truncated__ "Fish and crustaceans, molluscs and other aquatic invertebrates // Fish, fresh or chilled, excluding fish fillets and other fish"| __truncated__ "Fish and crustaceans, molluscs and other aquatic invertebrates // Fish, fresh or chilled, excluding fish fillets and other fish"| __truncated__ ...
#>  $ Qty Unit Code         : int  8 8 8 8 8 8 8 8 8 8 ...
#>  $ Qty Unit              : chr  "Weight in kilograms" "Weight in kilograms" "Weight in kilograms" "Weight in kilograms" ...
#>  $ Qty                   : logi  NA NA NA NA NA NA ...
#>  $ Alt Qty Unit Code     : chr  "" "" "" "" ...
#>  $ Alt Qty Unit          : int  1990895 3716297 27009 27009 27009 56 1 24184 995 44027 ...
#>  $ Alt Qty               : logi  NA NA NA NA NA NA ...
#>  $ Netweight (kg)        : int  1990895 3716297 27009 27009 27009 56 1 24184 995 44027 ...
#>  $ Gross weight (kg)     : logi  NA NA NA NA NA NA ...
#>  $ Trade Value (US$)     : int  26221924 58616602 296381 296381 296381 505 18 152958 10456 486974 ...
#>  $ CIF Trade Value (US$) : logi  NA NA NA NA NA NA ...
#>  $ FOB Trade Value (US$) : logi  NA NA NA NA NA NA ...
#>  $ Flag                  : int  0 0 0 0 0 0 0 0 0 0 ...
```
